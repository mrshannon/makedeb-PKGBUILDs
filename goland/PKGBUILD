# Maintainer: Michael R. Shannon <mrshannon.aerospace@gmail.com>
# Contributor: Frederik Schwan <frederik dot schwan at linux dot com>

nolint=1
_pkgname=GoLand
pkgname=$(echo "$_pkgname" | tr '[:upper:]' '[:lower:]')
pkgver=2018.3.3
pkgrel=1
section='devel'
pkgdesc='Capable and Ergonomic Go IDE'
read -r -d '' pkglong <<"EOF"
GoLand is a commercial IDE by JetBrains aimed at providing an ergonomic
environment for Go development. GoLand extends the IntelliJ platform with the
coding assistance and tool integrations specific for the Go language.
EOF
arch=('amd64')
url='https://www.jetbrains.com/go/'
license=('Commercial')
source=("https://download.jetbrains.com/go/${pkgname}-${pkgver}.tar.gz"
        "jetbrains-goland.desktop")
sha256sums=('2ee5c2c22d3a8b130a6e3dd7212ace7faba0e9cb28e17b2ae266cf4e1040bf18'
            '2f1ffecf1811b3c9ae52fae5ec9ecc17e828aace6f044d65cdeb35d75e4e38d1')

prepare() {
  # remove other architectures
  rm -rf "${srcdir}/${_pkgname}-${pkgver}/bin/fsnotifier"
  rm -rf "${srcdir}/${_pkgname}-${pkgver}/bin/fsnotifier-arm"
  rm -rf "${srcdir}/${_pkgname}-${pkgver}/lib/libpty/linux/x86"
}

package() {

    # install goland
    install -dm755 "${pkgdir}/opt/jetbrains/${pkgname}"
    tar -C "${srcdir}/${_pkgname}-${pkgver}" -cf - \
        . | tar -C "${pkgdir}/opt/jetbrains/${pkgname}" -xf -

    # install binary
    install -dm755 "${pkgdir}/usr/bin/"
    ln -s "/opt/jetbrains/${pkgname}/bin/${pkgname}.sh" \
            "${pkgdir}/usr/bin/${pkgname}"

    # install .desktop
    install -Dm644 "${srcdir}/jetbrains-${pkgname}.desktop" \
            "${pkgdir}/usr/share/applications/jetbrains-${pkgname}.desktop"

    # install icon
    install -Dm644 "${srcdir}/${_pkgname}-${pkgver}/bin/${pkgname}.png" \
            "${pkgdir}/usr/share/pixmaps/${pkgname}.png"

    # install docs
    install -dm755 "${docdir}"
    tar -C "${srcdir}/${_pkgname}-${pkgver}/license/" -cf - \
        . | tar -C "${docdir}/" -xf -
}
